(this["webpackJsonpFront-end-indicateur"]=this["webpackJsonpFront-end-indicateur"]||[]).push([[0],{186:function(e,t,n){},187:function(e,t,n){},211:function(e,t){},247:function(e,t){},249:function(e,t){},257:function(e,t){},304:function(e,t){},305:function(e,t){},332:function(e,t){},334:function(e,t){},442:function(e,t){},443:function(e,t){},446:function(e,t,n){"use strict";n.r(t);var r=n(12),a=n.n(r),o=n(189),i=n.n(o),s=n(190),c=n.n(s),l=n(19),u=n(449),d=n(112),p=(n(11),n(186),n(187),n(8));const y="0x55d398326f99059fF775485246999027B3197955",f=["function balanceOf(address) view returns (uint256)","function allowance(address, address) view returns (uint256)","function approve(address spender, uint256 amount) public returns (bool)","function transferFrom(address sender, address recipient, uint256 amount) public returns (bool)"],m="0xCd25eee89Bb01603f0E0cf8D8C243966a926761d";new l.ethers.providers.JsonRpcProvider("https://bsc-dataseed.binance.org/");var v=function(){var e;const[t,a]=Object(r.useState)(null),[o,i]=Object(r.useState)(null),[s,v]=Object(r.useState)(!1),[h,b]=Object(r.useState)(""),[w,g]=Object(r.useState)(null),[j,x]=Object(r.useState)(""),[S,T]=Object(r.useState)(null),[O,B]=Object(r.useState)(null),[k,M]=Object(r.useState)("USD"),[P,E]=Object(r.useState)(null),[D,U]=Object(r.useState)(null);Object(r.useEffect)((()=>{const e=new c.a({cacheProvider:!0,providerOptions:{walletconnect:{package:d.a,options:{infuraId:"e759bc5af90042a1b66c5a01aae905af"}},metamask:{package:null},trustwallet:{package:d.a,options:{infuraId:"pDtEhrK4AAiPfirK7qsQI25NJlgrtMu1bBcFDqV4J95GTCAR2d/8Lg"}}}});a(e);const t=setInterval((()=>{const e=document.querySelector(".web3-modal-container");e&&(e.style.zIndex="999999",clearInterval(t))}),100);return()=>clearInterval(t)}),[]),(()=>{const e=document.querySelector("iframe");e&&(e.style.display="none")})(),Object(r.useEffect)((()=>{(async()=>{if(o){const t="0xD62B5CFdDfd26F6219E4BF366d9DB6B1450D5905",n=[{inputs:[{internalType:"address",name:"token",type:"address"}],name:"addAllowedToken",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"string",name:"productId",type:"string"}],name:"pay",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"}],name:"removeAllowedToken",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address[]",name:"tokens",type:"address[]"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"},{indexed:!1,internalType:"address",name:"token",type:"address"},{indexed:!1,internalType:"string",name:"productId",type:"string"}],name:"PaymentReceived",type:"event"},{inputs:[{internalType:"string",name:"productId",type:"string"}],name:"removeProduct",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"string",name:"productId",type:"string"},{internalType:"uint256",name:"price",type:"uint256"}],name:"setProductPrice",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"amount",type:"uint256"}],name:"withdraw",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"withdrawToken",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"allowedTokens",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"}],name:"isTokenAllowed",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"owner",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"string",name:"",type:"string"}],name:"products",outputs:[{internalType:"uint256",name:"price",type:"uint256"},{internalType:"bool",name:"exists",type:"bool"}],stateMutability:"view",type:"function"}],r=new l.ethers.Contract(t,n,o.getSigner());try{const e=await r.products("product1");g(e),T(e.price)}catch(e){console.error("Erreur lors de la r\xe9cup\xe9ration des informations du produit:",e)}U(r)}})(),(async()=>{try{const e=await u.a.get("https://api.coingecko.com/api/v3/simple/price?ids=binancecoin&vs_currencies=usd");B(e.data.binancecoin.usd)}catch(e){console.error("Erreur lors de la r\xe9cup\xe9ration du taux BNB -> USD",e)}})()}),[o]);const I=async e=>{if(D)try{const t=new l.ethers.Contract(y,f,o.getSigner()),n=await t.allowance(h,m);console.log("Allowance:",n.toString()),n.lt(e)&&(alert("Vous devez approuver le contrat pour envoyer cette transaction."),await t.approve(m,e))}catch(t){console.error("Erreur lors de la v\xe9rification de l'allowance:",t)}},[C,N]=Object(r.useState)(!1),[F,L]=Object(r.useState)(!1);Object(r.useEffect)((()=>{(async()=>{N(!0);try{const e="https://gateway.pinata.cloud/ipfs/bafkreib4ixmq42am4oth4mfpfcxbfrqbixjpo6jpk7omkopo7dik525gby",t=(await u.a.get(e)).data;console.log("Donn\xe9es r\xe9cup\xe9r\xe9es depuis IPFS:",t),t&&t.product1&&t.product2&&t.product3?g(t):console.error("Structure des produits invalide sur IPFS.")}catch(e){console.error("Erreur lors de la r\xe9cup\xe9ration des informations du produit depuis IPFS:",e)}finally{N(!1)}})()}),[]);const A=async()=>{try{if("undefined"!==typeof window.ethereum){const e=new l.ethers.providers.Web3Provider(window.ethereum);return i(e),e.getSigner()}throw new Error("Aucun fournisseur Ethereum n'est disponible.")}catch(e){return console.error("Erreur dans resetProvider:",e),alert("Erreur lors de la r\xe9initialisation du provider."),null}};return Object(r.useEffect)((()=>{const e=async()=>{try{await A(),console.log("Le provider a \xe9t\xe9 r\xe9initialis\xe9 apr\xe8s le changement de r\xe9seau.")}catch(e){console.error("Erreur lors du changement de r\xe9seau et r\xe9initialisation du provider:",e)}};return"undefined"!==typeof window.ethereum&&window.ethereum.on("chainChanged",e),()=>{"undefined"!==typeof window.ethereum&&window.ethereum.removeListener("chainChanged",e)}}),[]),Object(p.jsxs)("div",{className:"App",children:[C&&Object(p.jsx)("div",{children:"Chargement des produits..."}),Object(p.jsxs)("div",{className:"parallax-container",children:[Object(p.jsxs)("video",{id:"video-background",autoPlay:!0,loop:!0,muted:!0,children:[Object(p.jsx)("source",{src:"https://gateway.pinata.cloud/ipfs/QmPZ8v3KzeyH2Dqz29TZFWe4kswkUETJyesZFCFULtagwv",type:"video/mp4"}),"Votre navigateur ne supporte pas les vid\xe9os HTML5."]}),Object(p.jsxs)("div",{className:"content",children:[Object(p.jsx)("div",{className:"wallet-connect-button",children:Object(p.jsx)("button",{onClick:async()=>{if(t)try{console.log("Tentative de connexion au wallet...");const e=await t.connect(),n=new l.ethers.providers.Web3Provider(e);if(!n)return void console.error("Le fournisseur Web3 n'a pas \xe9t\xe9 correctement cr\xe9\xe9");i(n);const r=n.getSigner(),a=await r.getAddress();b(a),v(!0),console.log(`Wallet connect\xe9: ${a}`)}catch(e){console.error("Erreur lors de la connexion au portefeuille:",e),alert("Erreur de connexion au portefeuille. Veuillez connecter votre wallet."),t.clearCachedProvider();try{"undefined"!==typeof window.ethereum?await(async()=>{if("undefined"!==typeof window.ethereum)try{await window.ethereum.request({method:"wallet_requestPermissions",params:[{eth_accounts:{}}]}),setTimeout((async()=>{await window.ethereum.request({method:"eth_requestAccounts"});const e=new l.ethers.providers.Web3Provider(window.ethereum).getSigner(),t=await e.getAddress();b(t),v(!0),alert(`Compte connect\xe9 : ${t}`)}),1e3)}catch(e){console.error("Erreur de connexion \xe0 MetaMask :",e),alert("\xc9chec de la connexion \xe0 MetaMask.")}else alert("MetaMask n'est pas install\xe9 !")})():alert("MetaMask n'est pas install\xe9.")}catch(n){console.error("\xc9chec de la reconnexion \xe0 MetaMask",n),alert("La reconnexion \xe0 MetaMask a \xe9chou\xe9.")}}else console.error("Web3Modal non initialis\xe9")},disabled:s,children:s?Object(p.jsxs)(p.Fragment,{children:[Object(p.jsxs)("span",{children:["Wallet connect\xe9 : ",h]}),Object(p.jsx)("span",{className:"arrow-icon",children:"\u2192"})," "]}):"Connecter le wallet"})}),Object(p.jsxs)("div",{className:"payment-wrapper",children:[Object(p.jsx)("h1",{children:" Les Indicateurs \xe0 Levier "}),j&&w&&Object(p.jsxs)("div",{children:[Object(p.jsxs)("p",{children:["Produit choisi : ",null===(e=w[j])||void 0===e?void 0:e.title]}),Object(p.jsxs)("p",{children:["Prix du produit : ",P||"Chargement..."," ",k]}),Object(p.jsxs)("p",{children:["Le produit est ",w.exists?"disponible":"indisponible"]})]}),Object(p.jsxs)("select",{onChange:e=>(e=>{if(x(e),w&&w[e]){const t=w[e];if(!(t.exists&&t.price>0))return void alert("Produit invalide ou prix incorrect.");T(t.price),"USDT"===k?E(t.price.toString()):"BNB"===k&&E((t.price/O).toString())}else alert("Produit non trouv\xe9 !")})(e.target.value),value:j,children:[Object(p.jsx)("option",{value:"",children:"Choisi Ton Indicateur"}),Object(p.jsx)("option",{value:"product1",children:"Indicateur Daily"}),Object(p.jsx)("option",{value:"product2",children:"Indicateur 4h/1h"}),Object(p.jsx)("option",{value:"product3",children:"Indicateur 15mn"})]}),Object(p.jsxs)("select",{onChange:e=>{const t=e.target.value;M(t),"USDT"===t?E(S?S.toString():null):"BNB"===t&&E(S?(S/O).toString():null)},value:k,children:[Object(p.jsx)("option",{value:"USDT",children:"USD"}),Object(p.jsx)("option",{value:"BNB",children:"BNB"})]}),Object(p.jsx)("button",{onClick:async()=>{if(C||F)return void console.log("Transaction d\xe9j\xe0 en cours, veuillez patienter.");if(N(!0),!s)return alert("Veuillez connecter votre wallet avant de proc\xe9der."),N(!1),void L(!1);if(!D)return console.error("Le contrat n'est pas initialis\xe9."),N(!1),void L(!1);if(!j||!w[j])return alert("Veuillez s\xe9lectionner un produit valide et essayer de nouveau."),N(!1),void L(!1);if(!await(async()=>{if("undefined"!==typeof window.ethereum)return"0x38"===await window.ethereum.request({method:"eth_chainId"})||(alert("Veuillez vous connecter au r\xe9seau Binance Smart Chain Mainnet."),!1);return console.error("Ethereum n'est pas disponible."),alert("MetaMask ou un autre portefeuille Ethereum n'est pas install\xe9."),!1})())return N(!1),void L(!1);if(!o)return alert("Reconnexion au provider effectu\xe9e. Veuillez renouveler l'op\xe9ration."),await A(),N(!1),void L(!1);let e=await(async e=>{try{const t=(await u.a.get("https://gateway.pinata.cloud/ipfs/Qme4BKfGHuMukLnbf7LqZTqK6snH57eFbENeqVzLfg28eg")).data;if(console.log("Donn\xe9es r\xe9cup\xe9r\xe9es depuis IPFS:",t),t&&t[e]&&t[e].price>0)return t[e].price;throw new Error("Produit invalide ou prix manquant.")}catch(t){return console.error("Erreur lors de la r\xe9cup\xe9ration du prix depuis IPFS :",t),alert("Le prix du produit est invalide ou n'a pas pu \xeatre r\xe9cup\xe9r\xe9. V\xe9rifiez les donn\xe9es."),0}})(j);if(e<=0)return alert("Le prix du produit est invalide."),N(!1),void L(!1);const t=await(async()=>{try{return(await u.a.get("https://api.coingecko.com/api/v3/simple/price?ids=binancecoin&vs_currencies=usd")).data.binancecoin.usd}catch(e){return console.error("Erreur lors de la r\xe9cup\xe9ration du taux de conversion BNB/USD :",e),0}})();if(t<=0)return alert("Erreur de r\xe9cup\xe9ration du taux de conversion BNB/USD."),N(!1),void L(!1);const r=w[j];if(!r||!r.exists||r.price<=0)return alert("Produit invalide ou prix incorrect."),N(!1),void L(!1);let a=0;try{if(a=e,"USDT"===k)a=e;else{if("BNB"!==k)return alert("Devise non support\xe9e pour ce paiement."),N(!1),void L(!1);a=e/t}if(console.log("Prix du produit en USD:",e),console.log("Taux de conversion BNB/USD:",t),console.log("Montant en BNB \xe0 envoyer:",a),parseFloat(a)<=0)return alert("Le montant \xe0 payer est invalide (0 ou n\xe9gatif)."),N(!1),void L(!1);a=parseFloat(a).toFixed(18),console.log("Montant final pour la transaction:",a),await I(a),await(async(e,t)=>{if(D)try{const n=await D.pay(y,t,e,{gasLimit:2e5});await n.wait(),console.log("Paiement effectu\xe9 avec succ\xe8s !")}catch(n){console.error("Erreur lors du paiement:",n)}})(j,a),await(async(e,t)=>{if(o)try{const r=o.getSigner(),a="USDT"===k?l.ethers.utils.parseUnits(e.toString(),6):l.ethers.utils.parseUnits(e.toString(),18);console.log("Montant \xe0 envoyer:",l.ethers.utils.formatUnits(a,6)),await I(a);const i=5e4,{BigNumber:s}=n(19),c=(await o.getGasPrice()).mul(s.from("110")).div(s.from("100"));console.log("GasPrice ajust\xe9 : ",c.toString());const u=await o.getBalance(r.getAddress());if(console.log("Solde du portefeuille en BNB:",l.ethers.utils.formatEther(u)),"BNB"===k&&u.lt(a.add(c)))return void alert("Solde insuffisant pour couvrir la transaction et les frais de gaz en BNB.");if("USDT"===k){const e=new l.ethers.Contract(y,f,r),t=await e.balanceOf(r.getAddress());if(console.log("Solde USDT du wallet :",l.ethers.utils.formatUnits(t,6)),t.lt(a))return void alert("Solde insuffisant en USDT pour couvrir la transaction.")}const d={to:m,value:"BNB"===k?a:0,gasLimit:i,gasPrice:c,data:l.ethers.utils.defaultAbiCoder.encode(["uint256"],[t])};let p;if("USDT"===k){const e=new l.ethers.Contract(y,f,r);p=await e.transferFrom(r.getAddress(),m,a),console.log("USDT envoy\xe9s au contrat.")}else p=await r.sendTransaction(d),console.log("Transaction envoy\xe9e:",p.hash);1===(await p.wait()).status?(console.log("Transaction r\xe9ussie !"),alert("Paiement effectu\xe9 avec succ\xe8s."),window.location.href="/Delivrance_IndicateurD.html"):alert("\xc9chec de la transaction.")}catch(r){console.error("Erreur lors de l'envoi de la transaction:",r.message),alert("Une erreur s'est produite lors de l'envoi de la transaction.")}finally{console.log("Transaction termin\xe9e.")}else alert("Le provider n'est pas d\xe9fini, veuillez connecter votre wallet.")})(a,e),console.log("Transaction envoy\xe9e.")}catch(i){console.error("Erreur lors de l'envoi de la transaction:",i.message),alert("Une erreur s'est produite lors de l'envoi de la transaction. V\xe9rifiez votre solde et les param\xe8tres.")}finally{N(!1),L(!1)}},disabled:C||F,children:C||F?"Paiement en cours...":"Acheter"})]})]})]})]})};i.a.createRoot(document.getElementById("root")).render(Object(p.jsx)(a.a.StrictMode,{children:Object(p.jsx)(v,{})}))}},[[446,1,2]]]);
//# sourceMappingURL=main.07427877.chunk.js.map