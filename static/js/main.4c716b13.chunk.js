(this["webpackJsonpFront-end-indicateur"]=this["webpackJsonpFront-end-indicateur"]||[]).push([[0],{186:function(e,t,n){},187:function(e,t,n){},211:function(e,t){},247:function(e,t){},249:function(e,t){},257:function(e,t){},304:function(e,t){},305:function(e,t){},332:function(e,t){},334:function(e,t){},442:function(e,t){},443:function(e,t){},446:function(e,t,n){"use strict";n.r(t);var a=n(11),r=n.n(a),o=n(189),i=n.n(o),s=n(190),c=n.n(s),l=n(25),u=n(449),d=n(112),p=(n(10),n(186),n(187),n(13));const y="0x55d398326f99059fF775485246999027B3197955",b=["function balanceOf(address) view returns (uint256)","function allowance(address, address) view returns (uint256)","function approve(address spender, uint256 amount) public returns (bool)","function transferFrom(address sender, address recipient, uint256 amount) public returns (bool)"];new l.a.providers.JsonRpcProvider("https://bsc-dataseed.binance.org/");var m=function(){const[e,t]=Object(a.useState)(null),[n,r]=Object(a.useState)(null),[o,i]=Object(a.useState)(!1),[s,m]=Object(a.useState)(""),[f,h]=Object(a.useState)(null),[w,v]=Object(a.useState)(null),[g,j]=Object(a.useState)(""),[x,S]=Object(a.useState)(null),[T,O]=Object(a.useState)(null),[k,M]=Object(a.useState)("USD"),[B,P]=Object(a.useState)(null),[A,D]=Object(a.useState)(null),I={product1:{price:5,exists:!0,title:"Indicateur Daily"},product2:{price:295,exists:!0,title:"Indicateur 4h/1h"},product3:{price:495,exists:!0,title:"Indicateur 15mn"}};Object(a.useEffect)((()=>{const e=new c.a({cacheProvider:!0,providerOptions:{walletconnect:{package:d.a,options:{infuraId:"e759bc5af90042a1b66c5a01aae905af"}},metamask:{package:null},trustwallet:{package:d.a,options:{infuraId:"pDtEhrK4AAiPfirK7qsQI25NJlgrtMu1bBcFDqV4J95GTCAR2d/8Lg"}}}});t(e);const n=setInterval((()=>{const e=document.querySelector(".web3-modal-container");e&&(e.style.zIndex="999999",clearInterval(n))}),100);return()=>clearInterval(n)}),[]),(()=>{const e=document.querySelector("iframe");e&&(e.style.display="none")})(),Object(a.useEffect)((()=>{(async()=>{if(n){const t="0xCd25eee89Bb01603f0E0cf8D8C243966a926761d",a=[{inputs:[{internalType:"address",name:"token",type:"address"}],name:"addAllowedToken",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"string",name:"productId",type:"string"}],name:"pay",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"}],name:"removeAllowedToken",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address[]",name:"tokens",type:"address[]"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"},{indexed:!1,internalType:"address",name:"token",type:"address"},{indexed:!1,internalType:"string",name:"productId",type:"string"}],name:"PaymentReceived",type:"event"},{inputs:[{internalType:"string",name:"productId",type:"string"}],name:"removeProduct",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"string",name:"productId",type:"string"},{internalType:"uint256",name:"price",type:"uint256"}],name:"setProductPrice",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"amount",type:"uint256"}],name:"withdraw",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"withdrawToken",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"allowedTokens",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"}],name:"isTokenAllowed",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"owner",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"string",name:"",type:"string"}],name:"products",outputs:[{internalType:"uint256",name:"price",type:"uint256"},{internalType:"bool",name:"exists",type:"bool"}],stateMutability:"view",type:"function"}],r=new l.a.Contract(t,a,n.getSigner());try{const e=await r.products("product1");h(e),S(e.price)}catch(e){console.error("Erreur lors de la r\xe9cup\xe9ration des informations du produit:",e)}D(r)}})(),(async()=>{try{const e=await u.a.get("https://api.coingecko.com/api/v3/simple/price?ids=binancecoin&vs_currencies=usd");O(e.data.binancecoin.usd)}catch(e){console.error("Erreur lors de la r\xe9cup\xe9ration du taux BNB -> USD",e)}})()}),[n]);const[C,E]=Object(a.useState)(!1),[U,N]=Object(a.useState)(!1),q=async e=>{try{const t=new l.a.Contract(y,b,n.getSigner());(await t.allowance(s,A.address)).lt(e)?(console.log("Allowance insuffisante, demande d'approbation..."),await z(e)):console.log("Allowance suffisante")}catch(t){console.error("Erreur lors de la v\xe9rification de l'allowance",t)}},z=async e=>{try{const t=new l.a.Contract(y,b,n.getSigner());console.log("Demande d'approbation pour un montant de:",e.toString());const a=await t.approve(A.address,e);console.log("Transaction d'approbation envoy\xe9e:",a.hash);1===(await a.wait()).status?console.log("Approvisionnement effectu\xe9 avec succ\xe8s !"):console.error("La transaction d'approbation a \xe9chou\xe9."),await L(e)}catch(t){console.error("Erreur lors de l'approbation du token",t),alert("\xc9chec de l'approbation du token.")}},L=async e=>{try{const t="BNB"===k?l.a.constants.AddressZero:y,n=w,a=await A.pay(t,e,n,{value:"BNB"===k?e:0});console.log("Paiement effectu\xe9 avec succ\xe8s. Tx hash:",a.hash);1===(await a.wait()).status?alert("Achat r\xe9ussi !"):alert("\xc9chec de la transaction.")}catch(t){console.error("Erreur lors du paiement:",t),alert("Une erreur s'est produite lors du paiement.")}};return Object(p.jsxs)("div",{className:"App",children:[Object(p.jsx)("h1",{children:"Test de Paiement Multi-Produits avec Blockchain"}),Object(p.jsx)("button",{onClick:async()=>{if(e)try{console.log("Tentative de connexion au wallet...");const t=await e.connect(),n=new l.a.providers.Web3Provider(t);if(!n)return void console.error("Le fournisseur Web3 n'a pas \xe9t\xe9 correctement cr\xe9\xe9");r(n);const a=n.getSigner(),o=await a.getAddress();m(o),i(!0),console.log(`Wallet connect\xe9: ${o}`)}catch(t){console.error("Erreur lors de la connexion au portefeuille:",t),alert("Erreur de connexion au portefeuille. Veuillez connecter votre wallet."),e.clearCachedProvider();try{"undefined"!==typeof window.ethereum?await(async()=>{if("undefined"!==typeof window.ethereum)try{await window.ethereum.request({method:"wallet_requestPermissions",params:[{eth_accounts:{}}]}),setTimeout((async()=>{await window.ethereum.request({method:"eth_requestAccounts"});const e=new l.a.providers.Web3Provider(window.ethereum).getSigner(),t=await e.getAddress();m(t),i(!0),alert(`Compte connect\xe9 : ${t}`)}),1e3)}catch(t){console.error("Erreur de connexion \xe0 MetaMask :",t),alert("\xc9chec de la connexion \xe0 MetaMask.")}else alert("MetaMask n'est pas install\xe9 !")})():alert("MetaMask n'est pas install\xe9.")}catch(n){console.error("\xc9chec de la reconnexion \xe0 MetaMask",n),alert("La reconnexion \xe0 MetaMask a \xe9chou\xe9.")}}else console.error("Web3Modal non initialis\xe9")},children:o?`Wallet connect\xe9 : ${s}`:"Connecter le wallet"}),g&&f&&Object(p.jsxs)("div",{children:[Object(p.jsxs)("p",{children:["Produit choisi : ",g]}),Object(p.jsxs)("p",{children:["Prix du produit : ",B||"Chargement..."," ",k]}),Object(p.jsxs)("p",{children:["Le produit est ",f.exists?"disponible":"indisponible"]})]}),Object(p.jsxs)("select",{onChange:e=>{const t=e.target.value;v(t),(e=>{j(e);const t=I[e];if(t){const{price:e,exists:n}=t;S(e),h({price:e,exists:n}),"USD"===k?P(e?e.toString():null):"BNB"===k&&P(e?(e/T).toString():null)}else console.error("Produit non trouv\xe9 !")})(t)},value:w,children:[Object(p.jsx)("option",{value:"",children:"S\xe9lectionnez un produit"}),Object(p.jsx)("option",{value:"product1",children:"Produit 1"}),Object(p.jsx)("option",{value:"product2",children:"Produit 2"}),Object(p.jsx)("option",{value:"product3",children:"Produit 3"})]}),Object(p.jsxs)("select",{onChange:e=>{const t=e.target.value;M(t),"USD"===t?P(x?x.toString():null):"BNB"===t&&P(x?(x/T).toString():null)},value:k,children:[Object(p.jsx)("option",{value:"USD",children:"USD"}),Object(p.jsx)("option",{value:"BNB",children:"BNB"})]}),Object(p.jsx)("button",{onClick:async()=>{if(o)if(g&&x){let t=0;try{if("USD"===k)t=x;else{if("BNB"!==k)return void alert("Devise non support\xe9e pour ce paiement.");if(!T)return void alert("Le taux de conversion BNB vers USD est en cours de chargement.");t=x/T}t=l.a.utils.parseUnits(t.toString(),"USDT"===k?6:18),console.log("Montant pour la transaction:",t),await q(t),console.log("Paiement pr\xeat \xe0 \xeatre effectu\xe9."),await L(t),console.log("Transaction envoy\xe9e.")}catch(e){console.error("Erreur lors du calcul du montant:",e.message),alert("Une erreur s'est produite. Veuillez v\xe9rifier vos param\xe8tres.")}}else alert("Veuillez s\xe9lectionner un produit valide.");else alert("Veuillez connecter votre wallet avant de proc\xe9der.")},children:"Payer pour le produit"})]})};i.a.createRoot(document.getElementById("root")).render(Object(p.jsx)(r.a.StrictMode,{children:Object(p.jsx)(m,{})}))}},[[446,1,2]]]);
//# sourceMappingURL=main.4c716b13.chunk.js.map