{"ast":null,"code":"import React,{useEffect,useState,useRef}from'react';import Web3Modal from'web3modal';import{ethers}from'ethers';import axios from'axios';import WalletConnectProvider from\"@walletconnect/web3-provider\";import process from'process';import'./App.css';// Importation du fichier CSS\nimport'./index.css';// Ajoute cette ligne dans ton fichier JavaScript\n// Adresse du contrat USDT sur BSC (assure-toi que c'est l'adresse correcte pour le r√©seau que tu utilises)\nimport{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const usdtAddress='0x55d398326f99059fF775485246999027B3197955';// Adresse du contrat USDT sur Binance Smart Chain\n// ABI pour le contrat USDT\nconst usdtABI=[\"function balanceOf(address) view returns (uint256)\",\"function allowance(address, address) view returns (uint256)\",\"function approve(address spender, uint256 amount) public returns (bool)\",\"function transferFrom(address sender, address recipient, uint256 amount) public returns (bool)\"];const contractAddress='0xCd25eee89Bb01603f0E0cf8D8C243966a926761d';const bscTestnetRpcUrl=\"https://bsc-dataseed.binance.org/\";// BSC Mainnet\nconst bscTestnetProvider=new ethers.providers.JsonRpcProvider(bscTestnetRpcUrl);function App(){var _productInfo$productI;const[web3Modal,setWeb3Modal]=useState(null);const[provider,setProvider]=useState(null);const[walletConnected,setWalletConnected]=useState(false);const[walletAddress,setWalletAddress]=useState('');const[selectedProductId,setSelectedProductId]=useState(null);// Ajouter l'√©tat selectedProductId\nconst[productInfo,setProductInfo]=useState({product1:{price:5,exists:true,title:\"Indicateur Daily\"},product2:{price:295,exists:true,title:\"Indicateur 4h/1h\"},product3:{price:495,exists:true,title:\"Indicateur 15mn\"}});const[productId,setProductId]=useState('');const[productPrice,setProductPrice]=useState(null);const[bnbToUsdRate,setBnbToUsdRate]=useState(null);const[selectedCurrency,setSelectedCurrency]=useState('USD');const[convertedPrice,setConvertedPrice]=useState(null);const[contractInstance,setContractInstance]=useState(null);// D√©clarez `contractInstance` ici\n// Initialisation de Web3Modal pour la connexion aux portefeuilles\nuseEffect(()=>{const modal=new Web3Modal({cacheProvider:true,// Gardera en cache la derni√®re connexion\nproviderOptions:{walletconnect:{package:WalletConnectProvider,// Utilisation de WalletConnectProvider\noptions:{infuraId:\"e759bc5af90042a1b66c5a01aae905af\"// Remplace avec ton propre infura ID\n}},metamask:{package:null// MetaMask ne n√©cessite pas de package\n},trustwallet:{package:WalletConnectProvider,// Utilisation de WalletConnectProvider pour Trust Wallet\noptions:{infuraId:\"pDtEhrK4AAiPfirK7qsQI25NJlgrtMu1bBcFDqV4J95GTCAR2d/8Lg\"// Remplace avec ton propre infura ID\n}}// Ajoute d'autres options de portefeuille ici si n√©cessaire (par exemple : Fortmatic, etc.)\n}});setWeb3Modal(modal);// V√©rifie si la modale est pr√©sente dans le DOM\nconst interval=setInterval(()=>{const web3ModalElement=document.querySelector('.web3-modal-container');if(web3ModalElement){web3ModalElement.style.zIndex='999999';// Modale au-dessus de tout\nclearInterval(interval);}},100);return()=>clearInterval(interval);},[]);// Masquer l'iframe si elle est pr√©sente\nconst hideIframe=()=>{const iframe=document.querySelector('iframe');if(iframe){iframe.style.display='none';// ou iframe.remove() si tu pr√©f√®res\n}};// Appel de la fonction pour masquer l'iframe au moment o√π Web3Modal est charg√©\nhideIframe();// Fonction pour reconnecter MetaMask\nconst reconnectToMetaMask=async()=>{if(typeof window.ethereum===\"undefined\"){alert(\"MetaMask n'est pas install√© !\");return;}try{await window.ethereum.request({method:'wallet_requestPermissions',params:[{eth_accounts:{}}]});setTimeout(async()=>{const accounts=await window.ethereum.request({method:'eth_requestAccounts'});const provider=new ethers.providers.Web3Provider(window.ethereum);const signer=provider.getSigner();const address=await signer.getAddress();setWalletAddress(address);setWalletConnected(true);alert(`Compte connect√© : ${address}`);},1000);}catch(error){console.error('Erreur de connexion √† MetaMask :',error);alert('√âchec de la connexion √† MetaMask.');}};// Connexion au wallet via Web3Modal\nconst connectWallet=async()=>{if(!web3Modal){console.error(\"Web3Modal non initialis√©\");return;}try{console.log(\"Tentative de connexion au wallet...\");// Connexion via Web3Modal\nconst instance=await web3Modal.connect();const newProvider=new ethers.providers.Web3Provider(instance);// S'assurer que le provider est correctement d√©fini\nif(!newProvider){console.error(\"Le fournisseur Web3 n'a pas √©t√© correctement cr√©√©\");return;}setProvider(newProvider);// R√©cup√©rer l'adresse du wallet\nconst signer=newProvider.getSigner();const address=await signer.getAddress();setWalletAddress(address);setWalletConnected(true);console.log(`Wallet connect√©: ${address}`);}catch(error){console.error(\"Erreur lors de la connexion au portefeuille:\",error);alert(\"Erreur de connexion au portefeuille. Veuillez connecter votre wallet.\");// Ferme Web3Modal\nweb3Modal.clearCachedProvider();// Relance le processus de reconnexion via MetaMask\ntry{if(typeof window.ethereum!==\"undefined\"){await reconnectToMetaMask();}else{alert(\"MetaMask n'est pas install√©.\");}}catch(retryError){console.error(\"√âchec de la reconnexion √† MetaMask\",retryError);alert(\"La reconnexion √† MetaMask a √©chou√©.\");}}};// R√©cup√©ration du taux de conversion BNB vers USD\nconst fetchBnbToUsdRate=async()=>{try{const response=await axios.get('https://api.coingecko.com/api/v3/simple/price?ids=binancecoin&vs_currencies=usd');setBnbToUsdRate(response.data.binancecoin.usd);}catch(error){console.error('Erreur lors de la r√©cup√©ration du taux BNB -> USD',error);}};// Charger les donn√©es du contrat et les informations du produit\nuseEffect(()=>{const loadBlockchainData=async()=>{if(provider){// Adresse du contrat et ABI\nconst contractAddress='0xD62B5CFdDfd26F6219E4BF366d9DB6B1450D5905';const contractABI=[{\"inputs\":[{\"internalType\":\"address\",\"name\":\"token\",\"type\":\"address\"}],\"name\":\"addAllowedToken\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"token\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"},{\"internalType\":\"string\",\"name\":\"productId\",\"type\":\"string\"}],\"name\":\"pay\",\"outputs\":[],\"stateMutability\":\"payable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"token\",\"type\":\"address\"}],\"name\":\"removeAllowedToken\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address[]\",\"name\":\"tokens\",\"type\":\"address[]\"}],\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"user\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"},{\"indexed\":false,\"internalType\":\"address\",\"name\":\"token\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"string\",\"name\":\"productId\",\"type\":\"string\"}],\"name\":\"PaymentReceived\",\"type\":\"event\"},{\"inputs\":[{\"internalType\":\"string\",\"name\":\"productId\",\"type\":\"string\"}],\"name\":\"removeProduct\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"string\",\"name\":\"productId\",\"type\":\"string\"},{\"internalType\":\"uint256\",\"name\":\"price\",\"type\":\"uint256\"}],\"name\":\"setProductPrice\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"}],\"name\":\"withdraw\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"token\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"}],\"name\":\"withdrawToken\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"name\":\"allowedTokens\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"token\",\"type\":\"address\"}],\"name\":\"isTokenAllowed\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"owner\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"name\":\"products\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"price\",\"type\":\"uint256\"},{\"internalType\":\"bool\",\"name\":\"exists\",\"type\":\"bool\"}],\"stateMutability\":\"view\",\"type\":\"function\"}];// Cr√©e une nouvelle instance du contrat avec le provider\nconst contract=new ethers.Contract(contractAddress,contractABI,provider.getSigner());// Appel direct √† la m√©thode du contrat, sans attendre que contractInstance soit mis √† jour\ntry{const productDetails=await contract.products(\"product1\");setProductInfo(productDetails);setProductPrice(productDetails.price);}catch(error){console.error(\"Erreur lors de la r√©cup√©ration des informations du produit:\",error);}// Stocke cette instance dans l'√©tat\nsetContractInstance(contract);}};loadBlockchainData();fetchBnbToUsdRate();},[provider]);// D√©pendance sur 'provider' uniquement, pas besoin de contractInstance ici\nconst approveUSDT=async amountToSend=>{// R√©cup√©rer le signer √† partir du provider\nconst signer=provider.getSigner();// Cr√©er une instance du contrat USDT\nconst usdtContract=new ethers.Contract(usdtAddress,usdtABI,signer);try{// V√©rifier l'allowance actuelle\nconst allowance=await usdtContract.allowance(await signer.getAddress(),contractAddress);// Si l'allowance est insuffisante, approuver le montant n√©cessaire\nif(allowance.lt(amountToSend)){console.log(\"Allowance insuffisante, approbation en cours...\");const tx=await usdtContract.approve(contractAddress,amountToSend);await tx.wait();console.log(\"Allowance mise √† jour !\");}else{console.log(\"Allowance suffisante.\");}}catch(error){console.error(\"Erreur lors de l'approbation de l'allowance USDT :\",error);}};const checkAllowance=async amountToSend=>{if(contractInstance){try{const usdtContract=new ethers.Contract(usdtAddress,usdtABI,provider.getSigner());const allowance=await usdtContract.allowance(walletAddress,contractAddress);console.log(\"Allowance:\",allowance.toString());if(allowance.lt(amountToSend)){alert(\"Vous devez approuver le contrat pour envoyer cette transaction.\");await usdtContract.approve(contractAddress,amountToSend);}}catch(error){console.error(\"Erreur lors de la v√©rification de l'allowance:\",error);}}};const payForProduct=async(productId,amount)=>{if(contractInstance){try{const tx=await contractInstance.pay(usdtAddress,amount,productId,{gasLimit:200000// Ajuste selon les besoins\n});await tx.wait();// Attends la confirmation de la transaction\nconsole.log(\"Paiement effectu√© avec succ√®s !\");}catch(error){console.error(\"Erreur lors du paiement:\",error);}}};const[loading,setLoading]=useState(false);// Ajout de l'√©tat loading\nconst[transactionInProgress,setTransactionInProgress]=useState(false);const fetchProductInfo=productId=>{const localProducts={product1:{price:5,exists:true,title:\"Indicateur Daily\"},product2:{price:295,exists:true,title:\"Indicateur 4h/1h\"},product3:{price:495,exists:true,title:\"Indicateur 15mn\"}};const product=localProducts[productId];return product?product.price:0;// Renvoie 0 si le produit n'est pas trouv√©\n};// Fonction conversion BNB/USDT\nconst getBnbToUsdRate=async()=>{try{const response=await axios.get('https://api.coingecko.com/api/v3/simple/price?ids=binancecoin&vs_currencies=usd');const bnbToUsdRate=response.data.binancecoin.usd;return bnbToUsdRate;}catch(error){console.error(\"Erreur lors de la r√©cup√©ration du taux de conversion BNB/USD :\",error);return 0;}};const sendTransaction=async(amountIn,fetchedPriceInUsd)=>{if(!provider){alert(\"Le provider n'est pas d√©fini, veuillez connecter votre wallet.\");return;}try{const signer=provider.getSigner();// üî• Convertir correctement le montant selon la devise\nconst amountToSend=selectedCurrency==='USDT'?ethers.utils.parseUnits(amountIn.toString(),6)// USDT a 6 d√©cimales\n:ethers.utils.parseUnits(amountIn.toString(),18);// BNB a 18 d√©cimales\n// üõ†Ô∏è Obtenir le gas price et l'ajuster\nconst gasLimit=50000;const gasPrice=await provider.getGasPrice();const adjustedGasPrice=gasPrice.mul(110).div(100);// +10%\nconsole.log(\"GasPrice ajust√© : \",adjustedGasPrice.toString());// üîç V√©rifier le solde pour BNB\nconst walletBalance=await provider.getBalance(signer.getAddress());if(selectedCurrency==='BNB'&&walletBalance.lt(amountToSend.add(adjustedGasPrice))){alert(\"Solde insuffisant pour couvrir la transaction et les frais de gaz en BNB.\");return;}// üîç V√©rifier le solde + allowance pour USDT\nif(selectedCurrency==='USDT'){const usdtContract=new ethers.Contract(usdtAddress,usdtABI,signer);const usdtBalance=await usdtContract.balanceOf(signer.getAddress());if(usdtBalance.lt(amountToSend)){alert(\"Solde insuffisant en USDT pour couvrir la transaction.\");return;}const allowance=await usdtContract.allowance(signer.getAddress(),contractAddress);if(allowance.lt(amountToSend)){// Appel √† la fonction approveUSDT si l'allowance est insuffisante\nalert(\"Vous devez approuver le contrat pour utiliser vos USDT.\");await approveUSDT(amountToSend);// Appel de la fonction approveUSDT pour donner l'allowance n√©cessaire\n}}// Pr√©parer la transaction\nconst tx={to:contractAddress,value:selectedCurrency==='BNB'?amountToSend:0,gasLimit:gasLimit,gasPrice:adjustedGasPrice,data:ethers.utils.defaultAbiCoder.encode([\"uint256\"],[fetchedPriceInUsd])};let transactionResponse;if(selectedCurrency==='USDT'){const usdtContract=new ethers.Contract(usdtAddress,usdtABI,signer);transactionResponse=await usdtContract.transferFrom(signer.getAddress(),contractAddress,amountToSend);console.log(\"USDT envoy√©s au contrat.\");}else{transactionResponse=await signer.sendTransaction(tx);console.log(\"Transaction envoy√©e:\",transactionResponse.hash);}const receipt=await transactionResponse.wait();if(receipt.status===1){console.log(\"Transaction r√©ussie !\");alert(\"Paiement effectu√© avec succ√®s.\");window.location.href='/Delivrance_IndicateurD.html';}else{alert(\"√âchec de la transaction.\");}}catch(error){console.error(\"Erreur lors de l'envoi de la transaction:\",error.message);alert(\"Une erreur s'est produite lors de l'envoi de la transaction.\");}finally{console.log(\"Transaction termin√©e.\");}};const checkNetwork=async()=>{if(typeof window.ethereum!==\"undefined\"){const network=await window.ethereum.request({method:'eth_chainId'});// V√©rifie si l'utilisateur est bien sur BSC Testnet (chainId 97)\nif(network!=='0x38'){// 0x38 est le chainId pour BSC Mainnet\nalert(\"Veuillez vous connecter au r√©seau Binance Smart Chain Mainnet.\");return false;}return true;}else{console.error(\"Ethereum n'est pas disponible.\");alert(\"MetaMask ou un autre portefeuille Ethereum n'est pas install√©.\");return false;}};// Fonction pour r√©initialiser le provider\nconst resetProvider=async()=>{try{if(typeof window.ethereum!==\"undefined\"){const newProvider=new ethers.providers.Web3Provider(window.ethereum);setProvider(newProvider);// Mettre √† jour le provider\n// Attendre que React ait bien mis √† jour le provider\nreturn newProvider.getSigner();// Retourner le signer apr√®s que le provider ait √©t√© mis √† jour\n}else{throw new Error(\"Aucun fournisseur Ethereum n'est disponible.\");}}catch(error){console.error(\"Erreur dans resetProvider:\",error);alert(\"Erreur lors de la r√©initialisation du provider.\");return null;}};// V√©rification du r√©seau √† chaque fois qu'il change\nuseEffect(()=>{const changeNetworkHandler=async()=>{try{await resetProvider();// Remet √† jour le provider lorsque le r√©seau change\nconsole.log(\"Le provider a √©t√© r√©initialis√© apr√®s le changement de r√©seau.\");}catch(error){console.error(\"Erreur lors du changement de r√©seau et r√©initialisation du provider:\",error);}};if(typeof window.ethereum!==\"undefined\"){window.ethereum.on('chainChanged',changeNetworkHandler);}// Nettoyage quand le composant est d√©mont√©\nreturn()=>{if(typeof window.ethereum!==\"undefined\"){window.ethereum.removeListener('chainChanged',changeNetworkHandler);}};},[]);const handlePayment=async()=>{if(loading||transactionInProgress){console.log(\"Transaction d√©j√† en cours, veuillez patienter.\");return;// Emp√™che l'ex√©cution si une autre transaction est en cours\n}setLoading(true);// Emp√™che d'envoyer une nouvelle transaction si une est d√©j√† en cours\nif(!walletConnected){alert(\"Veuillez connecter votre wallet avant de proc√©der.\");setLoading(false);// Permet de d√©verrouiller le bouton si une erreur survient\nsetTransactionInProgress(false);// R√©initialise l'√©tat de la transaction\nreturn;}// V√©rifie que le contrat est bien initialis√©\nif(!contractInstance){console.error(\"Le contrat n'est pas initialis√©.\");setLoading(false);setTransactionInProgress(false);return;}// V√©rifie que le produit est bien s√©lectionn√©\nif(!productId||!productInfo[productId]){alert(\"Veuillez s√©lectionner un produit valide et essayer de nouveau.\");setLoading(false);setTransactionInProgress(false);return;}// V√©rifie que l'utilisateur est sur le bon r√©seau\nconst isCorrectNetwork=await checkNetwork();if(!isCorrectNetwork){setLoading(false);setTransactionInProgress(false);return;}// V√©rifier que le provider est disponible\nif(!provider){alert(\"Reconnexion au provider effectu√©e. Veuillez renouveler l'op√©ration.\");await resetProvider();setLoading(false);setTransactionInProgress(false);return;}// R√©cup√©ration du prix en USD depuis IPFS\nlet fetchedPriceInUsd=await fetchProductInfo(productId);if(fetchedPriceInUsd<=0){alert(\"Le prix du produit est invalide.\");setLoading(false);setTransactionInProgress(false);return;}// R√©cup√©ration du taux de conversion BNB/USD\nconst bnbToUsdRate=await getBnbToUsdRate();if(bnbToUsdRate<=0){alert(\"Erreur de r√©cup√©ration du taux de conversion BNB/USD.\");setLoading(false);setTransactionInProgress(false);return;}// R√©cup√©rer les d√©tails du produit\nconst productDetails=productInfo[productId];if(!productDetails||!productDetails.exists||productDetails.price<=0){alert(\"Produit invalide ou prix incorrect.\");setLoading(false);setTransactionInProgress(false);return;}// --- Ajout de la fonction pour r√©cup√©rer le prix du produit ---\nlet amountIn=0;try{// Utilisation directement de fetchedPriceInUsd\namountIn=fetchedPriceInUsd;// V√©rification de la devise et calcul du montant √† envoyer\nif(selectedCurrency==='USDT'){amountIn=fetchedPriceInUsd;// Utilise directement le prix en USD\n}else if(selectedCurrency==='BNB'){amountIn=fetchedPriceInUsd/bnbToUsdRate;// Conversion de USD en BNB\n}else{alert(\"Devise non support√©e pour ce paiement.\");setLoading(false);setTransactionInProgress(false);return;}// Logs de v√©rification\nconsole.log(\"Prix du produit en USD:\",fetchedPriceInUsd);console.log(\"Taux de conversion BNB/USD:\",bnbToUsdRate);console.log(\"Montant en BNB √† envoyer:\",amountIn);// V√©rifier que amountIn est valide et non nul avant d'envoyer la transaction\nif(parseFloat(amountIn)<=0){alert(\"Le montant √† payer est invalide (0 ou n√©gatif).\");setLoading(false);setTransactionInProgress(false);return;}// Convertir le montant √† un format acceptable (fix√© √† 18 d√©cimales)\namountIn=parseFloat(amountIn).toFixed(18);console.log('Montant final pour la transaction:',amountIn);// Envoyer la transaction\nawait checkAllowance(amountIn);// Passe amountIn ici\nawait payForProduct(productId,amountIn);// Passe amountIn ici\nawait sendTransaction(amountIn,fetchedPriceInUsd);console.log(\"Transaction envoy√©e.\");}catch(error){console.error(\"Erreur lors de l'envoi de la transaction:\",error.message);alert(\"Une erreur s'est produite lors de l'envoi de la transaction. V√©rifiez votre solde et les param√®tres.\");}finally{setLoading(false);// Permet de d√©verrouiller le bouton apr√®s l'ex√©cution\nsetTransactionInProgress(false);// R√©initialise l'√©tat de la transaction\n}};// Mise √† jour des informations du produit s√©lectionn√©\nconst updateProductInfo=selectedProductId=>{setProductId(selectedProductId);// V√©rifie si le produit existe et s'il est valide\nif(productInfo&&productInfo[selectedProductId]){const productDetails=productInfo[selectedProductId];// V√©rifie que le produit existe et a un prix valide\nif(productDetails.exists&&productDetails.price>0){setProductPrice(productDetails.price);// Mise √† jour du prix converti\nif(selectedCurrency==='USDT'){setConvertedPrice(productDetails.price.toString());}else if(selectedCurrency==='BNB'){setConvertedPrice((productDetails.price/bnbToUsdRate).toString());}}else{alert(\"Produit invalide ou prix incorrect.\");return;}}else{alert(\"Produit non trouv√© !\");return;}};// Gestion du changement de devise (USD ou BNB)\nconst handleCurrencyChange=event=>{const newCurrency=event.target.value;setSelectedCurrency(newCurrency);if(newCurrency==='USDT'){setConvertedPrice(productPrice?productPrice.toString():null);}else if(newCurrency==='BNB'){setConvertedPrice(productPrice?(productPrice/bnbToUsdRate).toString():null);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"App\",children:[loading&&/*#__PURE__*/_jsx(\"div\",{children:\"Chargement des produits...\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"parallax-container\",children:[/*#__PURE__*/_jsxs(\"video\",{id:\"video-background\",autoPlay:true,loop:true,muted:true,children:[/*#__PURE__*/_jsx(\"source\",{src:\"https://gateway.pinata.cloud/ipfs/QmPZ8v3KzeyH2Dqz29TZFWe4kswkUETJyesZFCFULtagwv\",type:\"video/mp4\"}),\"Votre navigateur ne supporte pas les vid\\xE9os HTML5.\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"content\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"wallet-connect-button\",children:/*#__PURE__*/_jsx(\"button\",{onClick:connectWallet,disabled:walletConnected// D√©sactive le bouton une fois connect√©\n,children:walletConnected?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"Wallet connect\\xE9 : \",walletAddress]}),/*#__PURE__*/_jsx(\"span\",{className:\"arrow-icon\",children:\"\\u2192\"}),\" \"]}):'Connecter le wallet'})}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment-wrapper\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\" Les Indicateurs \\xE0 Levier \"}),productId&&productInfo&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"Produit choisi : \",(_productInfo$productI=productInfo[productId])===null||_productInfo$productI===void 0?void 0:_productInfo$productI.title]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Prix du produit : \",convertedPrice?convertedPrice:'Chargement...',\" \",selectedCurrency]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Le produit est \",productInfo.exists?'disponible':'indisponible']})]}),/*#__PURE__*/_jsxs(\"select\",{onChange:e=>updateProductInfo(e.target.value),value:productId,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Choisi Ton Indicateur\"}),/*#__PURE__*/_jsx(\"option\",{value:\"product1\",children:\"Indicateur Daily\"}),/*#__PURE__*/_jsx(\"option\",{value:\"product2\",children:\"Indicateur 4h/1h\"}),/*#__PURE__*/_jsx(\"option\",{value:\"product3\",children:\"Indicateur 15mn\"})]}),/*#__PURE__*/_jsxs(\"select\",{onChange:handleCurrencyChange,value:selectedCurrency,children:[/*#__PURE__*/_jsx(\"option\",{value:\"USDT\",children:\"USD\"}),/*#__PURE__*/_jsx(\"option\",{value:\"BNB\",children:\"BNB\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:handlePayment,disabled:loading||transactionInProgress,children:loading||transactionInProgress?\"Paiement en cours...\":\"Acheter\"})]})]})]})]});};export default App;","map":{"version":3,"names":["React","useEffect","useState","useRef","Web3Modal","ethers","axios","WalletConnectProvider","process","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","usdtAddress","usdtABI","contractAddress","bscTestnetRpcUrl","bscTestnetProvider","providers","JsonRpcProvider","App","_productInfo$productI","web3Modal","setWeb3Modal","provider","setProvider","walletConnected","setWalletConnected","walletAddress","setWalletAddress","selectedProductId","setSelectedProductId","productInfo","setProductInfo","product1","price","exists","title","product2","product3","productId","setProductId","productPrice","setProductPrice","bnbToUsdRate","setBnbToUsdRate","selectedCurrency","setSelectedCurrency","convertedPrice","setConvertedPrice","contractInstance","setContractInstance","modal","cacheProvider","providerOptions","walletconnect","package","options","infuraId","metamask","trustwallet","interval","setInterval","web3ModalElement","document","querySelector","style","zIndex","clearInterval","hideIframe","iframe","display","reconnectToMetaMask","window","ethereum","alert","request","method","params","eth_accounts","setTimeout","accounts","Web3Provider","signer","getSigner","address","getAddress","error","console","connectWallet","log","instance","connect","newProvider","clearCachedProvider","retryError","fetchBnbToUsdRate","response","get","data","binancecoin","usd","loadBlockchainData","contractABI","contract","Contract","productDetails","products","approveUSDT","amountToSend","usdtContract","allowance","lt","tx","approve","wait","checkAllowance","toString","payForProduct","amount","pay","gasLimit","loading","setLoading","transactionInProgress","setTransactionInProgress","fetchProductInfo","localProducts","product","getBnbToUsdRate","sendTransaction","amountIn","fetchedPriceInUsd","utils","parseUnits","gasPrice","getGasPrice","adjustedGasPrice","mul","div","walletBalance","getBalance","add","usdtBalance","balanceOf","to","value","defaultAbiCoder","encode","transactionResponse","transferFrom","hash","receipt","status","location","href","message","checkNetwork","network","resetProvider","Error","changeNetworkHandler","on","removeListener","handlePayment","isCorrectNetwork","parseFloat","toFixed","updateProductInfo","handleCurrencyChange","event","newCurrency","target","className","children","id","autoPlay","loop","muted","src","type","onClick","disabled","onChange","e"],"sources":["/home/nypsus/mon-projet-deploiement/Front-end-indicateur/src/App.js"],"sourcesContent":["import React, { useEffect, useState, useRef } from 'react';\nimport Web3Modal from 'web3modal';\nimport { ethers } from 'ethers';\nimport axios from 'axios';\nimport WalletConnectProvider from \"@walletconnect/web3-provider\";\nimport process from 'process';\nimport './App.css'; // Importation du fichier CSS\nimport './index.css'; // Ajoute cette ligne dans ton fichier JavaScript\n\n\n// Adresse du contrat USDT sur BSC (assure-toi que c'est l'adresse correcte pour le r√©seau que tu utilises)\nconst usdtAddress = '0x55d398326f99059fF775485246999027B3197955'; // Adresse du contrat USDT sur Binance Smart Chain\n\n// ABI pour le contrat USDT\nconst usdtABI = [\n  \"function balanceOf(address) view returns (uint256)\",\n  \"function allowance(address, address) view returns (uint256)\",\n  \"function approve(address spender, uint256 amount) public returns (bool)\",\n  \"function transferFrom(address sender, address recipient, uint256 amount) public returns (bool)\"\n];\n\n\n\n\nconst contractAddress = '0xCd25eee89Bb01603f0E0cf8D8C243966a926761d';\nconst bscTestnetRpcUrl = \"https://bsc-dataseed.binance.org/\"; // BSC Mainnet\nconst bscTestnetProvider = new ethers.providers.JsonRpcProvider(bscTestnetRpcUrl);\n\n\n\n\nfunction App() {\n  const [web3Modal, setWeb3Modal] = useState(null);\n  const [provider, setProvider] = useState(null);\n  const [walletConnected, setWalletConnected] = useState(false);\n  const [walletAddress, setWalletAddress] = useState('');\n  const [selectedProductId, setSelectedProductId] = useState(null);  // Ajouter l'√©tat selectedProductId\n  const [productInfo, setProductInfo] = useState({ \n  product1: { price: 5, exists: true, title: \"Indicateur Daily\" },\n  product2: { price: 295, exists: true, title: \"Indicateur 4h/1h\" },\n  product3: { price: 495, exists: true, title: \"Indicateur 15mn\" }\n});\n\n\n  const [productId, setProductId] = useState('');\n  const [productPrice, setProductPrice] = useState(null);\n  const [bnbToUsdRate, setBnbToUsdRate] = useState(null);\n  const [selectedCurrency, setSelectedCurrency] = useState('USD');\n  const [convertedPrice, setConvertedPrice] = useState(null);\n  const [contractInstance, setContractInstance] = useState(null); // D√©clarez `contractInstance` ici\n\n\n\n\n\n\n\n  \n  // Initialisation de Web3Modal pour la connexion aux portefeuilles\n  useEffect(() => {\n  const modal = new Web3Modal({\n    cacheProvider: true, // Gardera en cache la derni√®re connexion\n    providerOptions: {\n      walletconnect: {\n        package: WalletConnectProvider, // Utilisation de WalletConnectProvider\n        options: {\n          infuraId: \"e759bc5af90042a1b66c5a01aae905af\" // Remplace avec ton propre infura ID\n        }\n      },\n      metamask: {\n        package: null, // MetaMask ne n√©cessite pas de package\n        \n      },\n      trustwallet: {\n        package: WalletConnectProvider, // Utilisation de WalletConnectProvider pour Trust Wallet\n        options: {\n          infuraId: \"pDtEhrK4AAiPfirK7qsQI25NJlgrtMu1bBcFDqV4J95GTCAR2d/8Lg\" // Remplace avec ton propre infura ID\n        }\n      },\n      \n      // Ajoute d'autres options de portefeuille ici si n√©cessaire (par exemple : Fortmatic, etc.)\n    }\n  });\n\n  setWeb3Modal(modal);\n\n  // V√©rifie si la modale est pr√©sente dans le DOM\n  const interval = setInterval(() => {\n    const web3ModalElement = document.querySelector('.web3-modal-container');\n    if (web3ModalElement) {\n      web3ModalElement.style.zIndex = '999999'; // Modale au-dessus de tout\n      clearInterval(interval);\n    }\n  }, 100);\n\n  return () => clearInterval(interval);\n\n}, []);\n\n  \n\n\n  // Masquer l'iframe si elle est pr√©sente\n  const hideIframe = () => {\n    const iframe = document.querySelector('iframe');\n    if (iframe) {\n      iframe.style.display = 'none'; // ou iframe.remove() si tu pr√©f√®res\n    }\n  };\n\n  // Appel de la fonction pour masquer l'iframe au moment o√π Web3Modal est charg√©\n  hideIframe();\n  \n\n  // Fonction pour reconnecter MetaMask\n  const reconnectToMetaMask = async () => {\n    if (typeof window.ethereum === \"undefined\") {\n      alert(\"MetaMask n'est pas install√© !\");\n      return;\n    }\n\n    try {\n      \n      await window.ethereum.request({\n        method: 'wallet_requestPermissions',\n        params: [{\n          eth_accounts: {}\n        }]\n      });\n\n      setTimeout(async () => {\n        const accounts = await window.ethereum.request({\n          method: 'eth_requestAccounts',\n        });\n\n        const provider = new ethers.providers.Web3Provider(window.ethereum);\n        const signer = provider.getSigner();\n        const address = await signer.getAddress();\n\n        setWalletAddress(address);\n        setWalletConnected(true);\n        alert(`Compte connect√© : ${address}`);\n      }, 1000);\n    } catch (error) {\n      console.error('Erreur de connexion √† MetaMask :', error);\n      alert('√âchec de la connexion √† MetaMask.');\n    }\n  };\n\n\n  // Connexion au wallet via Web3Modal\n  const connectWallet = async () => {\n    if (!web3Modal) {\n      console.error(\"Web3Modal non initialis√©\");\n      return;\n    }\n    \n    try {\n      console.log(\"Tentative de connexion au wallet...\");\n      \n      \n      // Connexion via Web3Modal\n      const instance = await web3Modal.connect();\n      const newProvider = new ethers.providers.Web3Provider(instance);\n      \n      // S'assurer que le provider est correctement d√©fini\n      if (!newProvider) {\n        console.error(\"Le fournisseur Web3 n'a pas √©t√© correctement cr√©√©\");\n        return;\n      }\n      \n      setProvider(newProvider);\n  \n      // R√©cup√©rer l'adresse du wallet\n      const signer = newProvider.getSigner();\n      const address = await signer.getAddress();\n      \n      setWalletAddress(address);\n      setWalletConnected(true);\n      \n      console.log(`Wallet connect√©: ${address}`);\n    } catch (error) {\n      console.error(\"Erreur lors de la connexion au portefeuille:\", error);\n      alert(\"Erreur de connexion au portefeuille. Veuillez connecter votre wallet.\");\n      // Ferme Web3Modal\n      web3Modal.clearCachedProvider();\n\n      // Relance le processus de reconnexion via MetaMask\n      try {\n        if (typeof window.ethereum !== \"undefined\") {\n          await reconnectToMetaMask();\n        } else {\n          alert(\"MetaMask n'est pas install√©.\");\n        }\n      } catch (retryError) {\n        console.error(\"√âchec de la reconnexion √† MetaMask\", retryError);\n        alert(\"La reconnexion √† MetaMask a √©chou√©.\");\n      }\n    }\n  };\n  \n\n  // R√©cup√©ration du taux de conversion BNB vers USD\n  const fetchBnbToUsdRate = async () => {\n    try {\n      const response = await axios.get('https://api.coingecko.com/api/v3/simple/price?ids=binancecoin&vs_currencies=usd');\n      setBnbToUsdRate(response.data.binancecoin.usd);\n    } catch (error) {\n      console.error('Erreur lors de la r√©cup√©ration du taux BNB -> USD', error);\n    }\n  };\n\n   // Charger les donn√©es du contrat et les informations du produit\nuseEffect(() => {\n  const loadBlockchainData = async () => {\n    if (provider) {\n      // Adresse du contrat et ABI\n      const contractAddress = '0xD62B5CFdDfd26F6219E4BF366d9DB6B1450D5905';\n      const contractABI = [\n  {\n    \"inputs\": [\n      {\n        \"internalType\": \"address\",\n        \"name\": \"token\",\n        \"type\": \"address\"\n      }\n    ],\n    \"name\": \"addAllowedToken\",\n    \"outputs\": [],\n    \"stateMutability\": \"nonpayable\",\n    \"type\": \"function\"\n  },\n  {\n    \"inputs\": [\n      {\n        \"internalType\": \"address\",\n        \"name\": \"token\",\n        \"type\": \"address\"\n      },\n      {\n        \"internalType\": \"uint256\",\n        \"name\": \"amount\",\n        \"type\": \"uint256\"\n      },\n      {\n        \"internalType\": \"string\",\n        \"name\": \"productId\",\n        \"type\": \"string\"\n      }\n    ],\n    \"name\": \"pay\",\n    \"outputs\": [],\n    \"stateMutability\": \"payable\",\n    \"type\": \"function\"\n  },\n  {\n    \"inputs\": [\n      {\n        \"internalType\": \"address\",\n        \"name\": \"token\",\n        \"type\": \"address\"\n      }\n    ],\n    \"name\": \"removeAllowedToken\",\n    \"outputs\": [],\n    \"stateMutability\": \"nonpayable\",\n    \"type\": \"function\"\n  },\n  {\n    \"inputs\": [\n      {\n        \"internalType\": \"address[]\",\n        \"name\": \"tokens\",\n        \"type\": \"address[]\"\n      }\n    ],\n    \"stateMutability\": \"nonpayable\",\n    \"type\": \"constructor\"\n  },\n  {\n    \"anonymous\": false,\n    \"inputs\": [\n      {\n        \"indexed\": true,\n        \"internalType\": \"address\",\n        \"name\": \"user\",\n        \"type\": \"address\"\n      },\n      {\n        \"indexed\": false,\n        \"internalType\": \"uint256\",\n        \"name\": \"amount\",\n        \"type\": \"uint256\"\n      },\n      {\n        \"indexed\": false,\n        \"internalType\": \"address\",\n        \"name\": \"token\",\n        \"type\": \"address\"\n      },\n      {\n        \"indexed\": false,\n        \"internalType\": \"string\",\n        \"name\": \"productId\",\n        \"type\": \"string\"\n      }\n    ],\n    \"name\": \"PaymentReceived\",\n    \"type\": \"event\"\n  },\n  {\n    \"inputs\": [\n      {\n        \"internalType\": \"string\",\n        \"name\": \"productId\",\n        \"type\": \"string\"\n      }\n    ],\n    \"name\": \"removeProduct\",\n    \"outputs\": [],\n    \"stateMutability\": \"nonpayable\",\n    \"type\": \"function\"\n  },\n  {\n    \"inputs\": [\n      {\n        \"internalType\": \"string\",\n        \"name\": \"productId\",\n        \"type\": \"string\"\n      },\n      {\n        \"internalType\": \"uint256\",\n        \"name\": \"price\",\n        \"type\": \"uint256\"\n      }\n    ],\n    \"name\": \"setProductPrice\",\n    \"outputs\": [],\n    \"stateMutability\": \"nonpayable\",\n    \"type\": \"function\"\n  },\n  {\n    \"inputs\": [\n      {\n        \"internalType\": \"uint256\",\n        \"name\": \"amount\",\n        \"type\": \"uint256\"\n      }\n    ],\n    \"name\": \"withdraw\",\n    \"outputs\": [],\n    \"stateMutability\": \"nonpayable\",\n    \"type\": \"function\"\n  },\n  {\n    \"inputs\": [\n      {\n        \"internalType\": \"address\",\n        \"name\": \"token\",\n        \"type\": \"address\"\n      },\n      {\n        \"internalType\": \"uint256\",\n        \"name\": \"amount\",\n        \"type\": \"uint256\"\n      }\n    ],\n    \"name\": \"withdrawToken\",\n    \"outputs\": [],\n    \"stateMutability\": \"nonpayable\",\n    \"type\": \"function\"\n  },\n  {\n    \"inputs\": [\n      {\n        \"internalType\": \"address\",\n        \"name\": \"\",\n        \"type\": \"address\"\n      }\n    ],\n    \"name\": \"allowedTokens\",\n    \"outputs\": [\n      {\n        \"internalType\": \"bool\",\n        \"name\": \"\",\n        \"type\": \"bool\"\n      }\n    ],\n    \"stateMutability\": \"view\",\n    \"type\": \"function\"\n  },\n  {\n    \"inputs\": [\n      {\n        \"internalType\": \"address\",\n        \"name\": \"token\",\n        \"type\": \"address\"\n      }\n    ],\n    \"name\": \"isTokenAllowed\",\n    \"outputs\": [\n      {\n        \"internalType\": \"bool\",\n        \"name\": \"\",\n        \"type\": \"bool\"\n      }\n    ],\n    \"stateMutability\": \"view\",\n    \"type\": \"function\"\n  },\n  {\n    \"inputs\": [],\n    \"name\": \"owner\",\n    \"outputs\": [\n      {\n        \"internalType\": \"address\",\n        \"name\": \"\",\n        \"type\": \"address\"\n      }\n    ],\n    \"stateMutability\": \"view\",\n    \"type\": \"function\"\n  },\n  {\n    \"inputs\": [\n      {\n        \"internalType\": \"string\",\n        \"name\": \"\",\n        \"type\": \"string\"\n      }\n    ],\n    \"name\": \"products\",\n    \"outputs\": [\n      {\n        \"internalType\": \"uint256\",\n        \"name\": \"price\",\n        \"type\": \"uint256\"\n      },\n      {\n        \"internalType\": \"bool\",\n        \"name\": \"exists\",\n        \"type\": \"bool\"\n      }\n    ],\n    \"stateMutability\": \"view\",\n    \"type\": \"function\"\n\n    \n  }\n];\n\n\n\n\n        // Cr√©e une nouvelle instance du contrat avec le provider\n      const contract = new ethers.Contract(contractAddress, contractABI, provider.getSigner());\n\n      // Appel direct √† la m√©thode du contrat, sans attendre que contractInstance soit mis √† jour\n      try {\n        const productDetails = await contract.products(\"product1\");\n        setProductInfo(productDetails);\n        setProductPrice(productDetails.price);\n      } catch (error) {\n        console.error(\"Erreur lors de la r√©cup√©ration des informations du produit:\", error);\n      }\n      \n      // Stocke cette instance dans l'√©tat\n      setContractInstance(contract);\n    }\n  };\n\n  loadBlockchainData();\n  fetchBnbToUsdRate();\n}, [provider]);  // D√©pendance sur 'provider' uniquement, pas besoin de contractInstance ici\n\n\n\n\n\n\nconst approveUSDT = async (amountToSend) => {\n  // R√©cup√©rer le signer √† partir du provider\n  const signer = provider.getSigner();\n\n  // Cr√©er une instance du contrat USDT\n  const usdtContract = new ethers.Contract(usdtAddress, usdtABI, signer);\n\n  try {\n    // V√©rifier l'allowance actuelle\n    const allowance = await usdtContract.allowance(await signer.getAddress(), contractAddress);\n\n    // Si l'allowance est insuffisante, approuver le montant n√©cessaire\n    if (allowance.lt(amountToSend)) {\n      console.log(\"Allowance insuffisante, approbation en cours...\");\n      const tx = await usdtContract.approve(contractAddress, amountToSend);\n      await tx.wait();\n      console.log(\"Allowance mise √† jour !\");\n    } else {\n      console.log(\"Allowance suffisante.\");\n    }\n  } catch (error) {\n    console.error(\"Erreur lors de l'approbation de l'allowance USDT :\", error);\n  }\n};\n\n\n\n\nconst checkAllowance = async (amountToSend) => {\n  if (contractInstance) {\n    try {\n      const usdtContract = new ethers.Contract(usdtAddress, usdtABI, provider.getSigner());\n      const allowance = await usdtContract.allowance(walletAddress, contractAddress);\n\n      console.log(\"Allowance:\", allowance.toString());\n\n      if (allowance.lt(amountToSend)) {\n        alert(\"Vous devez approuver le contrat pour envoyer cette transaction.\");\n        await usdtContract.approve(contractAddress, amountToSend);\n      }\n    } catch (error) {\n      console.error(\"Erreur lors de la v√©rification de l'allowance:\", error);\n    }\n  }\n};\n\n\nconst payForProduct = async (productId, amount) => {\n  if (contractInstance) {\n    try {\n      const tx = await contractInstance.pay(usdtAddress, amount, productId, {\n        gasLimit: 200000,  // Ajuste selon les besoins\n      });\n      await tx.wait();  // Attends la confirmation de la transaction\n      console.log(\"Paiement effectu√© avec succ√®s !\");\n    } catch (error) {\n      console.error(\"Erreur lors du paiement:\", error);\n    }\n  }\n};\n\n\n\n\n  const [loading, setLoading] = useState(false); // Ajout de l'√©tat loading\n  const [transactionInProgress, setTransactionInProgress] = useState(false);\n\n\n  const fetchProductInfo = (productId) => {\n    const localProducts = {\n      product1: { price: 5, exists: true, title: \"Indicateur Daily\" },\n      product2: { price: 295, exists: true, title: \"Indicateur 4h/1h\" },\n      product3: { price: 495, exists: true, title: \"Indicateur 15mn\" }\n    };\n  \n    const product = localProducts[productId];\n    return product ? product.price : 0; // Renvoie 0 si le produit n'est pas trouv√©\n  };\n  \n\n\n\n// Fonction conversion BNB/USDT\n  const getBnbToUsdRate = async () => {\n    try {\n      const response = await axios.get('https://api.coingecko.com/api/v3/simple/price?ids=binancecoin&vs_currencies=usd');\n      const bnbToUsdRate = response.data.binancecoin.usd;\n      return bnbToUsdRate;\n    } catch (error) {\n      console.error(\"Erreur lors de la r√©cup√©ration du taux de conversion BNB/USD :\", error);\n      return 0;\n    }\n  };\n  \n  \n  \n  \n  const sendTransaction = async (amountIn, fetchedPriceInUsd) => {\n    if (!provider) {\n      alert(\"Le provider n'est pas d√©fini, veuillez connecter votre wallet.\");\n      return;\n    }\n  \n    try {\n      const signer = provider.getSigner();\n  \n      // üî• Convertir correctement le montant selon la devise\n      const amountToSend = selectedCurrency === 'USDT'\n        ? ethers.utils.parseUnits(amountIn.toString(), 6)  // USDT a 6 d√©cimales\n        : ethers.utils.parseUnits(amountIn.toString(), 18); // BNB a 18 d√©cimales\n  \n      // üõ†Ô∏è Obtenir le gas price et l'ajuster\n      const gasLimit = 50000;\n      const gasPrice = await provider.getGasPrice();\n      const adjustedGasPrice = gasPrice.mul(110).div(100); // +10%\n  \n      console.log(\"GasPrice ajust√© : \", adjustedGasPrice.toString());\n  \n      // üîç V√©rifier le solde pour BNB\n      const walletBalance = await provider.getBalance(signer.getAddress());\n      if (selectedCurrency === 'BNB' && walletBalance.lt(amountToSend.add(adjustedGasPrice))) {\n        alert(\"Solde insuffisant pour couvrir la transaction et les frais de gaz en BNB.\");\n        return;\n      }\n  \n      // üîç V√©rifier le solde + allowance pour USDT\n      if (selectedCurrency === 'USDT') {\n        const usdtContract = new ethers.Contract(usdtAddress, usdtABI, signer);\n        const usdtBalance = await usdtContract.balanceOf(signer.getAddress());\n  \n        if (usdtBalance.lt(amountToSend)) {\n          alert(\"Solde insuffisant en USDT pour couvrir la transaction.\");\n          return;\n        }\n  \n        const allowance = await usdtContract.allowance(signer.getAddress(), contractAddress);\n        if (allowance.lt(amountToSend)) {\n          // Appel √† la fonction approveUSDT si l'allowance est insuffisante\n          alert(\"Vous devez approuver le contrat pour utiliser vos USDT.\");\n          await approveUSDT(amountToSend); // Appel de la fonction approveUSDT pour donner l'allowance n√©cessaire\n        }\n      }\n  \n      // Pr√©parer la transaction\n      const tx = {\n        to: contractAddress,\n        value: selectedCurrency === 'BNB' ? amountToSend : 0,\n        gasLimit: gasLimit,\n        gasPrice: adjustedGasPrice,\n        data: ethers.utils.defaultAbiCoder.encode([\"uint256\"], [fetchedPriceInUsd]),\n      };\n  \n      let transactionResponse;\n      if (selectedCurrency === 'USDT') {\n        const usdtContract = new ethers.Contract(usdtAddress, usdtABI, signer);\n        transactionResponse = await usdtContract.transferFrom(\n          signer.getAddress(),\n          contractAddress,\n          amountToSend\n        );\n        console.log(\"USDT envoy√©s au contrat.\");\n      } else {\n        transactionResponse = await signer.sendTransaction(tx);\n        console.log(\"Transaction envoy√©e:\", transactionResponse.hash);\n      }\n  \n      const receipt = await transactionResponse.wait();\n      if (receipt.status === 1) {\n        console.log(\"Transaction r√©ussie !\");\n        alert(\"Paiement effectu√© avec succ√®s.\");\n        window.location.href = '/Delivrance_IndicateurD.html';\n      } else {\n        alert(\"√âchec de la transaction.\");\n      }\n  \n    } catch (error) {\n      console.error(\"Erreur lors de l'envoi de la transaction:\", error.message);\n      alert(\"Une erreur s'est produite lors de l'envoi de la transaction.\");\n    } finally {\n      console.log(\"Transaction termin√©e.\");\n    }\n  };\n  \n  \n  \n  \n  \n  \n  \n\n\n  const checkNetwork = async () => {\n    if (typeof window.ethereum !== \"undefined\") {\n      const network = await window.ethereum.request({\n        method: 'eth_chainId'\n      });\n  \n      // V√©rifie si l'utilisateur est bien sur BSC Testnet (chainId 97)\n      if (network !== '0x38') { // 0x38 est le chainId pour BSC Mainnet\n        alert(\"Veuillez vous connecter au r√©seau Binance Smart Chain Mainnet.\");\n        return false;\n      }\n      \n      return true;\n    } else {\n      console.error(\"Ethereum n'est pas disponible.\");\n      alert(\"MetaMask ou un autre portefeuille Ethereum n'est pas install√©.\");\n      return false;\n    }\n  };\n\n\n\n\n\n\n  // Fonction pour r√©initialiser le provider\n  const resetProvider = async () => {\n    try {\n      if (typeof window.ethereum !== \"undefined\") {\n        const newProvider = new ethers.providers.Web3Provider(window.ethereum);\n        setProvider(newProvider); // Mettre √† jour le provider\n\n        // Attendre que React ait bien mis √† jour le provider\n        return newProvider.getSigner(); // Retourner le signer apr√®s que le provider ait √©t√© mis √† jour\n      } else {\n        throw new Error(\"Aucun fournisseur Ethereum n'est disponible.\");\n      }\n    } catch (error) {\n      console.error(\"Erreur dans resetProvider:\", error);\n      alert(\"Erreur lors de la r√©initialisation du provider.\");\n      return null;\n    }\n  };\n\n  // V√©rification du r√©seau √† chaque fois qu'il change\n  useEffect(() => {\n    const changeNetworkHandler = async () => {\n      try {\n        await resetProvider(); // Remet √† jour le provider lorsque le r√©seau change\n        console.log(\"Le provider a √©t√© r√©initialis√© apr√®s le changement de r√©seau.\");\n      } catch (error) {\n        console.error(\"Erreur lors du changement de r√©seau et r√©initialisation du provider:\", error);\n      }\n    };\n\n    if (typeof window.ethereum !== \"undefined\") {\n      window.ethereum.on('chainChanged', changeNetworkHandler);\n    }\n\n    // Nettoyage quand le composant est d√©mont√©\n    return () => {\n      if (typeof window.ethereum !== \"undefined\") {\n        window.ethereum.removeListener('chainChanged', changeNetworkHandler);\n      }\n    };\n  }, []);\n  \n\n\n\n  const handlePayment = async () => {\n    if (loading || transactionInProgress) {\n      console.log(\"Transaction d√©j√† en cours, veuillez patienter.\");\n      return; // Emp√™che l'ex√©cution si une autre transaction est en cours\n    }\n    setLoading(true);  // Emp√™che d'envoyer une nouvelle transaction si une est d√©j√† en cours\n    \n    if (!walletConnected) {\n      alert(\"Veuillez connecter votre wallet avant de proc√©der.\");\n      setLoading(false);  // Permet de d√©verrouiller le bouton si une erreur survient\n      setTransactionInProgress(false);  // R√©initialise l'√©tat de la transaction\n      return;\n    }\n    \n    // V√©rifie que le contrat est bien initialis√©\n    if (!contractInstance) {\n      console.error(\"Le contrat n'est pas initialis√©.\");\n      setLoading(false);\n      setTransactionInProgress(false);\n      return;\n    }\n\n    // V√©rifie que le produit est bien s√©lectionn√©\n    if (!productId || !productInfo[productId]) {\n      alert(\"Veuillez s√©lectionner un produit valide et essayer de nouveau.\");\n      setLoading(false);\n      setTransactionInProgress(false);\n      return;\n    }\n\n    // V√©rifie que l'utilisateur est sur le bon r√©seau\n    const isCorrectNetwork = await checkNetwork();\n    if (!isCorrectNetwork) {\n      setLoading(false);\n      setTransactionInProgress(false);\n      return;\n    }\n\n    // V√©rifier que le provider est disponible\n    if (!provider) {\n      alert(\"Reconnexion au provider effectu√©e. Veuillez renouveler l'op√©ration.\");\n      await resetProvider();\n      setLoading(false);\n      setTransactionInProgress(false);\n      return;\n    }\n      \n\n    // R√©cup√©ration du prix en USD depuis IPFS\n    let fetchedPriceInUsd = await fetchProductInfo(productId);\n    if (fetchedPriceInUsd <= 0) {\n      alert(\"Le prix du produit est invalide.\");\n      setLoading(false);\n      setTransactionInProgress(false);\n      return;\n    }\n\n    // R√©cup√©ration du taux de conversion BNB/USD\n    const bnbToUsdRate = await getBnbToUsdRate();\n    if (bnbToUsdRate <= 0) {\n      alert(\"Erreur de r√©cup√©ration du taux de conversion BNB/USD.\");\n      setLoading(false);\n      setTransactionInProgress(false);\n      return;\n    }\n\n    // R√©cup√©rer les d√©tails du produit\n    const productDetails = productInfo[productId];\n\n    if (!productDetails || !productDetails.exists || productDetails.price <= 0) {\n      alert(\"Produit invalide ou prix incorrect.\");\n      setLoading(false);\n      setTransactionInProgress(false);\n      return;\n    }\n\n    // --- Ajout de la fonction pour r√©cup√©rer le prix du produit ---\n    let amountIn = 0;\n    try {\n      // Utilisation directement de fetchedPriceInUsd\n      amountIn = fetchedPriceInUsd;\n\n      // V√©rification de la devise et calcul du montant √† envoyer\n      if (selectedCurrency === 'USDT') {\n        amountIn = fetchedPriceInUsd; // Utilise directement le prix en USD\n      } else if (selectedCurrency === 'BNB') {\n        amountIn = fetchedPriceInUsd / bnbToUsdRate; // Conversion de USD en BNB\n      } else {\n        alert(\"Devise non support√©e pour ce paiement.\");\n        setLoading(false);\n        setTransactionInProgress(false);\n        return;\n      }\n\n      // Logs de v√©rification\n      console.log(\"Prix du produit en USD:\", fetchedPriceInUsd);\n      console.log(\"Taux de conversion BNB/USD:\", bnbToUsdRate);\n      console.log(\"Montant en BNB √† envoyer:\", amountIn);\n\n      // V√©rifier que amountIn est valide et non nul avant d'envoyer la transaction\n      if (parseFloat(amountIn) <= 0) {\n        alert(\"Le montant √† payer est invalide (0 ou n√©gatif).\");\n        setLoading(false);\n        setTransactionInProgress(false);\n        return;\n      }\n\n      // Convertir le montant √† un format acceptable (fix√© √† 18 d√©cimales)\n      amountIn = parseFloat(amountIn).toFixed(18);\n      console.log('Montant final pour la transaction:', amountIn);\n\n      // Envoyer la transaction\n      await checkAllowance(amountIn);  // Passe amountIn ici\n      await payForProduct(productId, amountIn);  // Passe amountIn ici\n\n      await sendTransaction(amountIn, fetchedPriceInUsd);\n\n      console.log(\"Transaction envoy√©e.\");\n\n    } catch (error) {\n      console.error(\"Erreur lors de l'envoi de la transaction:\", error.message);\n      alert(\"Une erreur s'est produite lors de l'envoi de la transaction. V√©rifiez votre solde et les param√®tres.\");\n    } finally {\n      setLoading(false);  // Permet de d√©verrouiller le bouton apr√®s l'ex√©cution\n      setTransactionInProgress(false);  // R√©initialise l'√©tat de la transaction\n    }\n};\n\n  \n\n  \n  \n  // Mise √† jour des informations du produit s√©lectionn√©\n  const updateProductInfo = (selectedProductId) => {\n    setProductId(selectedProductId);\n\n    // V√©rifie si le produit existe et s'il est valide\n    if (productInfo && productInfo[selectedProductId]) {\n        const productDetails = productInfo[selectedProductId];\n\n        // V√©rifie que le produit existe et a un prix valide\n        if (productDetails.exists && productDetails.price > 0) {\n            setProductPrice(productDetails.price);\n            \n            // Mise √† jour du prix converti\n            if (selectedCurrency === 'USDT') {\n                setConvertedPrice(productDetails.price.toString());\n            } else if (selectedCurrency === 'BNB') {\n                setConvertedPrice((productDetails.price / bnbToUsdRate).toString());\n            }\n        } else {\n            alert(\"Produit invalide ou prix incorrect.\");\n            return;\n        }\n    } else {\n        alert(\"Produit non trouv√© !\");\n        return;\n    }\n};\n\n\n\n  // Gestion du changement de devise (USD ou BNB)\n  const handleCurrencyChange = (event) => {\n    const newCurrency = event.target.value;\n    setSelectedCurrency(newCurrency);\n\n    if (newCurrency === 'USDT') {\n      setConvertedPrice(productPrice ? productPrice.toString() : null);\n    } else if (newCurrency === 'BNB') {\n      setConvertedPrice(productPrice ? (productPrice / bnbToUsdRate).toString() : null);\n    }\n  };\n\n  \n  \n\n  return (\n    <div className=\"App\">\n      {/* Afficher un message de chargement si `loading` est true */}\n      {loading && <div>Chargement des produits...</div>}\n\n      {/* Contenu principal */}\n      <div className=\"parallax-container\">\n        <video id=\"video-background\" autoPlay loop muted>\n          {/* Remplace la source locale par l'URL IPFS */}\n          <source \n            src=\"https://gateway.pinata.cloud/ipfs/QmPZ8v3KzeyH2Dqz29TZFWe4kswkUETJyesZFCFULtagwv\" \n            type=\"video/mp4\" \n          />\n          Votre navigateur ne supporte pas les vid√©os HTML5.\n        </video>\n\n        {/* Contenu d√©filant */}\n        <div className=\"content\">\n          \n\n          {/* Bouton de connexion du wallet en haut √† droite */}\n          <div className=\"wallet-connect-button\">\n            <button\n      \n              onClick={connectWallet}\n              disabled={walletConnected} // D√©sactive le bouton une fois connect√©\n            >\n              {walletConnected ? (\n                <>\n                  <span>Wallet connect√© : {walletAddress}</span>\n                  <span className=\"arrow-icon\">‚Üí</span> {/* Ic√¥ne fl√®che */}\n                </>\n              ) : (\n                'Connecter le wallet'\n              )}\n            </button>\n          </div>\n\n          {/* Conteneur du formulaire de paiement */}\n          <div className=\"payment-wrapper\">\n            <h1> Les Indicateurs √† Levier </h1>\n\n            {productId && productInfo && (\n              <div>\n                <p>Produit choisi : {productInfo[productId]?.title}</p>\n                <p>Prix du produit : {convertedPrice ? convertedPrice : 'Chargement...'} {selectedCurrency}</p>\n                <p>Le produit est {productInfo.exists ? 'disponible' : 'indisponible'}</p>\n              </div>\n            )}\n\n            <select onChange={(e) => updateProductInfo(e.target.value)} value={productId}>\n              <option value=\"\">Choisi Ton Indicateur</option>\n              <option value=\"product1\">Indicateur Daily</option>\n              <option value=\"product2\">Indicateur 4h/1h</option>\n              <option value=\"product3\">Indicateur 15mn</option>\n            </select>\n\n            <select onChange={handleCurrencyChange} value={selectedCurrency}>\n              <option value=\"USDT\">USD</option>\n              <option value=\"BNB\">BNB</option>\n            </select>\n\n            {/* Bouton de paiement */}\n            <button onClick={handlePayment} disabled={loading || transactionInProgress}>\n              {loading || transactionInProgress ? \"Paiement en cours...\" : \"Acheter\"}\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n\n  \n  \n};\n\n\nexport default App;\n\n\n\n\n\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}